@using PhasmoSheet.Core.Ghosts
@using PhasmoSheet.Core.Common
@using System.ComponentModel

@code {
    [Parameter]
    public Ghost Ghost { get; set; }

    [Inject]
    private GlobalState State { get; set; }

    private string GetCardColor()
    {
        if (State.CorrectGhosts.Contains(Ghost))
            return Colors.Green.Darken4;
        if (State.RuledOutGhosts.Contains(Ghost))
            return Colors.Red.Darken4;
        return "#0f0f0f";
    }


    private void OnStateChanged(object sender, PropertyChangedEventArgs e)
    {
        if (e.PropertyName == nameof(State.ConfirmedEvidences) || e.PropertyName == nameof(State.RuledOutEvidences))
        {
            StateHasChanged(); // Refresh the component
        }
    }

    protected override void OnInitialized()
    {
        State.PropertyChanged += OnStateChanged;
    }

    public void Dispose()
    {
        State.PropertyChanged -= OnStateChanged;
    }
}
<MudCard Style=@($"background-color: {GetCardColor()}; color: white; height: 256px; display: flex; flex-direction: column;")>
    <!-- Main Content Area -->
    <div Style="display: flex; flex-direction: column; flex: 1;">
        <MudCardHeader Style="height: fit-content;">
            <CardHeaderContent>
                <MudText Typo="Typo.h6">@Ghost.Name</MudText>
            </CardHeaderContent>
            <CardHeaderActions>
                <MudIconButton Icon="@Icons.Material.Filled.Check" Color="Color.Success" OnClick="@(() => State.ConfirmGhost(Ghost))" />
                <MudIconButton Icon="@Icons.Material.Filled.Close" Color="Color.Error" OnClick="@(() => State.RuleOutGhost(Ghost))" />
            </CardHeaderActions>
        </MudCardHeader>
        <MudCardContent Style="display: flex; flex: 1; overflow: hidden;">
            <!-- Left Half -->
            <div Style="flex: 1; padding: 0px 16px 0px 16px;">
                <MudText Typo="Typo.h5">
                    Evidences
                </MudText>
                <MudCardActions>
                    @foreach (var evidence in Ghost.Evidences)
                    {
                        <MudChip T="string"
                                 Variant="@(evidence == Ghost.GuaranteedEvidence ? Variant.Filled : Variant.Outlined)"
                                 Color="@(State.ConfirmedEvidences.Contains(evidence) ? Color.Success : Color.Error)">
                            @Format.Evidence(evidence)
                        </MudChip>
                    }
                </MudCardActions>
                <div style="display: flex; align-items: center;">
                    <img src="Icons/brain.svg" alt="Icon" style="margin-right: 10px; width: 24px; height: 24px; filter: brightness(0) invert(1);">
                    <div style="display: flex; justify-content: left; flex: 1;">@Ghost.MinSanityPercentage% @Ghost.FormatConditionalSanities()</div>
                </div>
                <br />
                <div style="display: flex; align-items: center;">
                    <img src="Icons/footstep.svg" alt="Icon" style="margin-right: 10px; width: 24px; height: 24px; filter: brightness(0) invert(1);">
                    <div style="display: flex; justify-content: left; flex: 1;">@Ghost.DefaultFootstepSpeed m/s @Ghost.FormatAdditionalSpeeds()</div>
                </div>
            </div>
            <!-- Right Half (Scrollable Text Block) -->
            <div Style="flex: 1; padding: 16px; overflow-y: auto; max-height: 128px;">
                <MudText Typo="Typo.body2">
                    @if (Ghost.Tells.Length > 0)
                    {
                        <h3>Tells</h3>
                        @foreach (var ability in Ghost.Tells)
                        {
                            <div>• @ability</div>
                        }
                    }
                    @if (Ghost.RuleOuts.Length > 0)
                    {
                        <h3>Rule Outs</h3>
                        @foreach (var ability in Ghost.RuleOuts)
                        {
                            <div>• @ability</div>
                        }
                    }
                    @if (Ghost.ConfirmationTests.Length > 0)
                    {
                        <h3>Confirmation Tests</h3>
                        @foreach (var ability in Ghost.ConfirmationTests)
                        {
                            <div>• @ability</div>
                        }
                    }
                    @if (Ghost.Abilities.Length > 0)
                    {
                        <h3>Special Abilities</h3>
                        @foreach (var ability in Ghost.Abilities)
                        {
                            <div>• @ability</div>
                        }
                    }
                </MudText>
            </div>
        </MudCardContent>
    </div>
</MudCard>




